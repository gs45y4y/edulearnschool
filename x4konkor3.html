<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edulearnschool | Activities</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<meta name="description" content="EdulearnOS is a free, web-based operating system designed for education. Access a terminal, code runner, games, and secure browsing tools directly in your browser.">
    <meta name="keywords" content="web os, edulearn, online operating system, educational tools, javascript os, browser os, web desktop">
    <meta name="author" content="Edulearn corp.">
    <meta name="robots" content="index, follow">

    <meta property="og:title" content="EdulearnOS - Web-Based Educational OS">
    <meta property="og:description" content="Experience a fully functional desktop in your browser. Features include games, scramjet & ultraviolet bundled, and more. V4 Beta is live.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://edulearnschool.vercel.app/x4konkor3.html">
    <meta property="og:image" content="https://raw.githubusercontent.com/POX-dev/edulearnschool/main/imgs/example.png"> <meta property="og:site_name" content="EdulearnOS">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="EdulearnOS - Web-Based Educational OS">
    <meta name="twitter:description" content="Experience a fully functional desktop in your browser with EdulearnOS.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/POX-dev/edulearnschool/main/imgs/example.png">

    <meta name="theme-color" content="#5e97f6">

    <script type="application/ld+json">
    {
      "@context": "https://edulearnschool.vercel.app",
      "@type": "WebApplication",
      "name": "EdulearnOS",
      "applicationCategory": "Educational gaming",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "FREE",
        "priceCurrency": "USD"
      },
      "description": "A web-based operating system simulation with tools for education so you can have some fun during class ;)"
    }
    </script>
    <style>
        /* --- CSS REMAINS THE SAME AS BEFORE --- */
        :root {
            --bg-dark: #121212;
            --bg-light: #1e1e1e;
            --window-bg: #252525;
            --window-header: #2f2f2f;
            --text-main: #e0e0e0;
            --accent: #5e97f6;
            --taskbar-bg: rgba(18, 18, 18, 0.95);
            --taskbar-height: 52px;
            --border-color: #333;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, sans-serif; overflow: hidden;
            background-color: var(--bg-dark); background-size: cover; background-position: center;
            color: var(--text-main); transition: background-image 0.5s ease;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%235e97f6" stroke="white" stroke-width="2" stroke-linejoin="round"><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/></svg>') 1 1, auto;
        }

        .wp-iceland { background-image: url('https://www.usnews.com/object/image/00000162-f3a3-d0d5-a57f-fbf33c300000/3-vestrahorn-iceland.jpg?update-time=1745871301820&size=responsive970'); }
        .wp-rainier { background-image: url('https://www.usnews.com/object/image/00000162-f3a3-d0d5-a57f-fbf3af9b0000/20-mount-rainier-national-park.jpg?update-time=1745872131347&size=responsive970'); }
        .wp-windows { background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop'); }
        .wp-chrome { background-image: url('https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=2670&auto=format&fit=crop'); }
        .wp-linux { background-image: url('https://images.unsplash.com/photo-1629654297299-c8506221ca97?q=80&w=2574&auto=format&fit=crop'); }

        #watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; font-weight: bold; color: rgba(255, 255, 255, 0.4); text-shadow: 0 0 20px rgba(0,0,0,0.5); pointer-events: none; user-select: none; text-align: center; z-index: 0; }
        #watermark span.ver { color: rgba(94, 151, 246, 0.8); font-size: 0.5em; vertical-align: super; }

        #desktop { height: calc(100vh - var(--taskbar-height)); width: 100%; padding: 20px; display: flex; flex-direction: column; flex-wrap: wrap; align-content: flex-start; gap: 20px; position: relative; z-index: 1; }
        .app-icon { width: 85px; height: 95px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border-radius: 8px; transition: background 0.2s; text-align: center; }
        .app-icon:hover { background-color: rgba(255, 255, 255, 0.08); }
        .app-icon i { font-size: 36px; color: #ffffff; margin-bottom: 10px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)); }
        .app-icon span { font-size: 13px; text-shadow: 0 1px 4px rgba(0,0,0,0.9); color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; font-weight: 500; }

        #taskbar { position: absolute; bottom: 0; width: 100%; height: var(--taskbar-height); background: var(--taskbar-bg); backdrop-filter: blur(15px); display: flex; align-items: center; padding: 0 10px; border-top: 1px solid #444; z-index: 9999; box-shadow: 0 -2px 10px rgba(0,0,0,0.5); }
        #start-btn { width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 15px; cursor: pointer; transition: background 0.2s; background: rgba(255,255,255,0.05); }
        #start-btn:hover { background: rgba(255,255,255,0.15); }
        #start-btn i { font-size: 20px; color: white; }
        #taskbar-apps { display: flex; align-items: center; gap: 6px; }
        .taskbar-item { width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; border-radius: 6px; cursor: pointer; transition: all 0.2s; position: relative; }
        .taskbar-item:hover { background: rgba(255,255,255,0.1); }
        .taskbar-item.active { background: rgba(255,255,255,0.15); border-bottom: 3px solid var(--accent); }
        .taskbar-item i { color: white; font-size: 20px; }
        .shield-btn { color: #4a90e2; }
        
        .taskbar-close { position: absolute; top: -4px; right: -4px; width: 16px; height: 16px; background-color: #ff5f56; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 10px; color: white; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .taskbar-item:hover .taskbar-close { display: flex; }
        .taskbar-close:hover { background-color: #ff3b30; transform: scale(1.1); }

        #clock { margin-left: auto; color: #ddd; font-size: 14px; padding: 0 20px; font-weight: 500; cursor: pointer; height: 100%; display: flex; align-items: center; transition: background 0.2s; border-radius: 4px; }
        #clock:hover { background: rgba(255,255,255,0.1); color: white; }

        /* CALENDAR */
        #calendar-popup { position: absolute; bottom: 60px; right: 10px; width: 320px; background: #252525; border: 1px solid #444; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; flex-direction: column; z-index: 10000; padding: 15px; animation: slideUp 0.2s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .cal-title { font-size: 16px; font-weight: bold; color: white; }
        .cal-nav { background: transparent; border: none; color: #aaa; cursor: pointer; font-size: 14px; padding: 5px 10px; transition: 0.2s; }
        .cal-nav:hover { color: white; background: rgba(255,255,255,0.1); border-radius: 4px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; font-size: 13px; }
        .cal-day-name { color: #888; font-weight: 600; font-size: 12px; margin-bottom: 5px; }
        .cal-day { width: 36px; height: 36px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 50%; cursor: pointer; color: #ccc; border: 1px solid transparent; position: relative; }
        .cal-day:hover { background: rgba(255,255,255,0.1); color: white; }
        .cal-day.today { background: var(--accent); color: white; font-weight: bold; }
        .cal-day.selected { border-color: var(--accent); background: rgba(94, 151, 246, 0.2); }
        .cal-day.has-event::after { content: ''; position: absolute; bottom: 4px; width: 4px; height: 4px; background-color: #00d2ff; border-radius: 50%; }
        .cal-footer { margin-top: 15px; padding-top: 10px; border-top: 1px solid #333; display: none; flex-direction: column; gap: 8px; }
        .cal-footer.active { display: flex; }
        .cal-event-input { background: #1a1a1a; border: 1px solid #444; padding: 8px; color: white; border-radius: 4px; outline: none; width: 100%; font-size: 13px; }
        .cal-event-btn { background: var(--accent); color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .cal-event-display { font-size: 12px; color: #aaa; margin-bottom: 5px; font-style: italic; }

        /* TOAST */
        #notification-toast { position: absolute; top: 20px; right: -300px; width: 280px; background: #252525; border-left: 4px solid var(--accent); border-radius: 4px; padding: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); z-index: 20000; transition: right 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; flex-direction: column; }
        #notification-toast.show { right: 20px; }
        .toast-title { font-weight: bold; color: white; margin-bottom: 5px; font-size: 14px; }
        .toast-msg { color: #ccc; font-size: 13px; }

        /* START MENU */
        #start-menu { position: absolute; bottom: 60px; left: 10px; width: 320px; height: 450px; background: #252525; border: 1px solid #444; border-radius: 8px; display: none; flex-direction: column; z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); padding: 15px; }
        #start-search { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #1e1e1e; color: white; margin-bottom: 10px; outline: none; }
        #start-list { flex: 1; overflow-y: auto; }
        .start-item { display: flex; align-items: center; padding: 8px; cursor: pointer; border-radius: 4px; }
        .start-item:hover { background: var(--accent); color: white; }
        .start-item i { width: 30px; text-align: center; margin-right: 10px; }

        /* WINDOWS */
        .window { position: absolute; background: var(--window-bg); border: 1px solid var(--border-color); border-radius: 10px; box-shadow: 0 15px 40px rgba(0,0,0,0.6); display: flex; flex-direction: column; min-width: 300px; min-height: 200px; resize: both; overflow: hidden; opacity: 0; animation: fadeIn 0.2s forwards; }
        .no-transition { transition: none !important; }
        @keyframes fadeIn { to { opacity: 1; } }
        .window-header { height: 40px; background: var(--window-header); display: flex; align-items: center; justify-content: space-between; padding: 0 12px; cursor: default; user-select: none; border-bottom: 1px solid var(--border-color); }
        .window-title { font-size: 14px; font-weight: 500; color: #eee; display: flex; align-items: center; }
        .window-controls { display: flex; gap: 8px; }
        .window-controls div { width: 13px; height: 13px; border-radius: 50%; cursor: pointer; transition: transform 0.1s; }
        .window-controls div:hover { filter: brightness(1.2); }
        .win-max { background: #27c93f; } .win-min { background: #ffbd2e; } .win-close { background: #ff5f56; }
        .window-content { flex: 1; position: relative; background: var(--bg-light); }
        iframe { width: 100%; height: 100%; border: none; background: white; }

        .internal-app { padding: 20px; color: #ccc; height: 100%; overflow-y: auto; font-family: monospace; }
        .terminal-output { font-family: 'Consolas', monospace; font-size: 14px; color: #ddd; }
        .terminal-input-line { display: flex; margin-top: 10px; }
        .terminal-prompt { color: var(--accent); margin-right: 10px; font-weight: bold; }
        #term-input { background: transparent; border: none; color: white; flex: 1; outline: none; font-family: monospace; font-size: 14px; }

        /* CONTEXT MENU */
        #context-menu { position: absolute; background: #252525; border: 1px solid #444; border-radius: 8px; width: 180px; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 10000; padding: 5px 0; }
        .ctx-item { padding: 10px 15px; font-size: 13px; cursor: pointer; color: #eee; display: flex; align-items: center; }
        .ctx-item i { width: 20px; margin-right: 5px; color: #888; }
        .ctx-item:hover { background: var(--accent); color: white; }
        .ctx-header { padding: 8px 15px; font-size: 11px; color: #666; text-transform: uppercase; font-weight: bold; border-bottom: 1px solid #333; margin-bottom: 5px; cursor: default; }

        #snap-overlay { position: absolute; background: rgba(94, 151, 246, 0.15); border: 2px solid rgba(94, 151, 246, 0.5); z-index: 500; pointer-events: none; display: none; border-radius: 10px; }
    </style>
</head>
<body class="wp-iceland">

    <div id="watermark">EdulearnOS <span class="ver">V4 Beta</span></div>
    <div id="desktop"></div>
    <div id="snap-overlay"></div>

    <div id="notification-toast">
        <div class="toast-title"><i class="fa-regular fa-bell"></i> Reminder</div>
        <div class="toast-msg" id="toast-message">Event Details Here</div>
    </div>

    <div id="calendar-popup">
        <div class="cal-header">
            <button class="cal-nav" onclick="changeMonth(-1)"><i class="fa-solid fa-chevron-left"></i></button>
            <div class="cal-title" id="cal-month-year">Month Year</div>
            <button class="cal-nav" onclick="changeMonth(1)"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
        <div class="cal-grid" id="cal-grid"></div>
        <div class="cal-footer" id="cal-footer">
            <div class="cal-event-display" id="cal-event-display">No events for this day.</div>
            <input type="text" id="cal-input" class="cal-event-input" placeholder="Add event...">
            <button class="cal-event-btn" onclick="saveEvent()">Save Event</button>
        </div>
    </div>

    <div id="start-menu">
        <input type="text" id="start-search" placeholder="Search apps..." onkeyup="filterApps()">
        <div id="start-list"></div>
    </div>

    <div id="context-menu">
        <div class="ctx-header">General</div>
        <div class="ctx-item" onclick="createNewFile()"><i class="fa-solid fa-file-circle-plus"></i> New Text File</div>
        <div class="ctx-header">Backgrounds</div>
        <div class="ctx-item" onclick="setWallpaper('wp-iceland')"><i class="fa-solid fa-water"></i> Vestrahorn</div>
        <div class="ctx-item" onclick="setWallpaper('wp-rainier')"><i class="fa-solid fa-mountain"></i> Mt. Rainier</div>
        <div class="ctx-item" onclick="setWallpaper('wp-windows')"><i class="fa-brands fa-windows"></i> Windows</div>
        <div class="ctx-item" onclick="setWallpaper('wp-chrome')"><i class="fa-brands fa-chrome"></i> ChromeOS</div>
        <div class="ctx-item" onclick="setWallpaper('wp-linux')"><i class="fa-brands fa-linux"></i> Linux</div>
        <div class="ctx-header">System</div>
        <div class="ctx-item" onclick="location.reload()"><i class="fa-solid fa-power-off"></i> Restart</div>
    </div>

    <div id="taskbar">
        <div id="start-btn" onclick="toggleStartMenu()"><i class="fa-solid fa-circle-dot"></i></div>
        <div id="taskbar-apps">
            <div class="taskbar-item shield-btn" onclick="openShield()" title="Open Safe Browser">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
        </div>
        <div id="clock" onclick="toggleCalendar()">12:00 PM</div>
    </div>

    <script>
        // CONFIG
        let apps = [
            { id: 'sc', name: 'Scramjet', icon: 'fa-solid fa-globe', url: atob('Li9tbmh5NzhrcGxqZ3l1bi8=') },
            { id: 'uv', name: 'Ultraviolet', icon: 'fa-solid fa-globe', url: atob('Li9hY3RpdmUv') },
            { id: 'gn', name: 'Games', icon: 'fa-solid fa-gamepad', url: atob('Li9tYXRoL2duLW1hdGguaHRtbA==') },
            { id: 'term', name: 'Terminal', icon: 'fa-solid fa-terminal', isSystem: true },
            { id: 'e2e', name: 'E2EV2', icon: 'fa-solid fa-lock', url: atob('Li9lMmV2Mi5odG1s') },
            { id: 'dm', name: 'Dosmes AI', icon: 'fa-solid fa-chart-line', url: atob('aHR0cHM6Ly9kZXNtb3MubGF0') },
            { id: 'fs', name: 'Files', icon: 'fa-solid fa-folder', url: atob('Li9maWxlcy5odG1s') }, 
            { id: 'gc', name: 'Graphing', icon: 'fa-solid fa-chart-simple', url: atob('Li9ncmFwaGNhbGMuaHRtbA==') },
            { id: 'p', name: 'Paint', icon: 'fa-solid fa-palette', url: atob('Li9wYWludC5odG1s') },
            { id: 'mp', name: 'Music', icon: 'fa-solid fa-music', url: atob('Li9tdXNpY3BsYXllci5odG1s') },
            { id: 'te', name: 'Text Editor', icon: 'fa-solid fa-file-lines', url: atob('Li90ZXh0ZWRpdG9yLmh0bWw=') },
            { id: 'cr', name: 'Code Runner', icon: 'fa-solid fa-code', url: atob('Li9jb2RlcnVubmVyLmh0bWw=') },
            { id: 'dc', name: 'Discord Server', icon: 'fa-brands fa-discord', url: atob('aHR0cHM6Ly9kaXNjb3JkLmdnL0VQbTVxbktrWU4=') },
            { id: 'cl', name: 'Changelog', icon: 'fa-solid fa-circle-info', url: atob('Li9pbmZvLmh0bWw=') },
            { id: 'tools', name: 'Tools', icon: 'fa-solid fa-wrench', url: atob('Li90b29scy5odG1s') },
            { id: 'imgs', name: 'Images', icon: 'fa-solid fa-camera', url: atob('Li9pbWFnZXMuaHRtbA==') },
			{ id: 'c', name: 'Credits', icon: 'fa-regular fa-circle-question', url: atob('Li9jcmVkaXRzLmh0bWw=') }
        ];

        let zIndexCounter = 100;
        let virtualDisk = {}; 

        // CALENDAR & FILE DATA
        let calDate = new Date();
        let selectedDateKey = null;
        let events = JSON.parse(localStorage.getItem('os_calendar_events')) || {};

        document.addEventListener('DOMContentLoaded', () => {
            renderDesktop();
            populateStartMenu();
            startClock();
            checkReminders();
            
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showContext(e.pageX, e.pageY);
            });
            document.addEventListener('click', (e) => {
                const ctx = document.getElementById('context-menu');
                const start = document.getElementById('start-menu');
                const startBtn = document.getElementById('start-btn');
                const cal = document.getElementById('calendar-popup');
                const clock = document.getElementById('clock');
                
                if(!ctx.contains(e.target)) ctx.style.display = 'none';
                if(!start.contains(e.target) && !startBtn.contains(e.target)) start.style.display = 'none';
                if(!cal.contains(e.target) && !clock.contains(e.target)) cal.style.display = 'none';
            });
        });

        // --- CORE FUNCTIONS ---

        // FIX: PROPER CLOAK (ABOUT:BLANK LAUNCHER)
        function openShield() {
            let win = window.open('about:blank', '_blank');
            if (!win) { alert("Pop-ups are blocked! Allow them to use the Shield."); return; }
            
            const doc = win.document;
            const iframe = doc.createElement('iframe');
            iframe.style.width = '100vw';
            iframe.style.height = '100vh';
            iframe.style.border = 'none';
            iframe.style.position = 'fixed';
            iframe.style.top = '0';
            iframe.style.left = '0';
            iframe.src = window.location.href; // Loads current OS into the blank tab
            
            doc.body.style.margin = '0';
            doc.body.appendChild(iframe);
        }

        // NEW: CREATE FILE FROM CONTEXT MENU
        function createNewFile() {
            const fileName = prompt("Enter file name (e.g., notes.txt):", "untitled.txt");
            if (fileName) {
                // Get existing files
                let storedFiles = JSON.parse(localStorage.getItem('edulearn_files')) || {};
                
                // Add new file
                storedFiles[fileName] = {
                    name: fileName,
                    content: "New text file created via Desktop.",
                    type: "file",
                    icon: "fa-regular fa-file-lines"
                };
                
                // Save back to storage
                localStorage.setItem('edulearn_files', JSON.stringify(storedFiles));
                
                // Show notification
                showToast(`File "${fileName}" saved. Open Files app to edit.`);
            }
        }

        function toggleCalendar() {
            const cal = document.getElementById('calendar-popup');
            if(cal.style.display === 'flex') { cal.style.display = 'none'; } else { cal.style.display = 'flex'; renderCalendar(); }
        }

        function renderCalendar() {
            const grid = document.getElementById('cal-grid');
            const title = document.getElementById('cal-month-year');
            grid.innerHTML = '';
            
            const year = calDate.getFullYear();
            const month = calDate.getMonth();
            const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
            title.innerText = `${months[month]} ${year}`;

            const days = ['Su','Mo','Tu','We','Th','Fr','Sa'];
            days.forEach(d => { const el = document.createElement('div'); el.className = 'cal-day-name'; el.innerText = d; grid.appendChild(el); });

            const firstDayIndex = new Date(year, month, 1).getDay();
            const lastDay = new Date(year, month + 1, 0).getDate();
            
            for(let i=0; i<firstDayIndex; i++) grid.appendChild(document.createElement('div'));

            const today = new Date();
            for(let i=1; i<=lastDay; i++) {
                const el = document.createElement('div'); el.className = 'cal-day'; el.innerText = i;
                const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                if(i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) el.classList.add('today');
                if(events[dateKey]) el.classList.add('has-event');
                if(selectedDateKey === dateKey) el.classList.add('selected');
                el.onclick = () => selectDate(dateKey, el);
                grid.appendChild(el);
            }
        }

        function changeMonth(step) { calDate.setMonth(calDate.getMonth() + step); renderCalendar(); }

        function selectDate(key, el) {
            selectedDateKey = key; renderCalendar();
            document.getElementById('cal-footer').classList.add('active');
            const input = document.getElementById('cal-input');
            input.value = events[key] || '';
            const display = document.getElementById('cal-event-display');
            display.innerHTML = events[key] ? `Event: <span style="color:#5e97f6">${events[key]}</span>` : "No events.";
            input.placeholder = events[key] ? "Edit event..." : "Add new event...";
            input.focus();
        }

        function saveEvent() {
            if(!selectedDateKey) return;
            const val = document.getElementById('cal-input').value.trim();
            if(val) events[selectedDateKey] = val; else delete events[selectedDateKey];
            localStorage.setItem('os_calendar_events', JSON.stringify(events));
            renderCalendar(); checkReminders();
        }

        function checkReminders() {
            const today = new Date();
            const dateKey = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
            if(events[dateKey] && !sessionStorage.getItem('notified_'+dateKey)) {
                showToast(events[dateKey]); sessionStorage.setItem('notified_'+dateKey, 'true');
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('notification-toast');
            document.getElementById('toast-message').innerText = msg;
            toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 5000);
        }

        function renderDesktop() {
            const desk = document.getElementById('desktop'); desk.innerHTML = '';
            apps.forEach(app => {
                const el = document.createElement('div'); el.className = 'app-icon';
                el.innerHTML = `<i class="${app.icon}"></i><span>${app.name}</span>`;
                el.onclick = () => openWindow(app); desk.appendChild(el);
            });
        }

        function setWallpaper(className) { document.body.className = className; }
        function startClock() { setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), 1000); }
        function showContext(x, y) { const menu = document.getElementById('context-menu'); menu.style.display = 'block'; menu.style.left = x + 'px'; menu.style.top = y + 'px'; }

        function toggleStartMenu() {
            const menu = document.getElementById('start-menu'); menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            document.getElementById('start-search').focus();
        }

        function populateStartMenu() {
            const list = document.getElementById('start-list'); list.innerHTML = '';
            apps.forEach(app => {
                const item = document.createElement('div'); item.className = 'start-item';
                item.innerHTML = `<i class="${app.icon}"></i> ${app.name}`;
                item.onclick = () => { openWindow(app); document.getElementById('start-menu').style.display = 'none'; };
                list.appendChild(item);
            });
        }

        function filterApps() {
            const query = document.getElementById('start-search').value.toLowerCase();
            document.querySelectorAll('.start-item').forEach(item => { item.style.display = item.innerText.toLowerCase().includes(query) ? 'flex' : 'none'; });
        }

        function openWindow(app, customContent = null) {
            const id = 'win-' + Date.now();
            const win = document.createElement('div'); win.className = 'window'; win.id = id; win.dataset.state = 'normal';
            win.style.left = '60px'; win.style.top = '40px'; win.style.width = '700px'; win.style.height = '500px'; win.style.zIndex = ++zIndexCounter;

            const header = document.createElement('div'); header.className = 'window-header';
            header.innerHTML = `<div class="window-title"><i class="${app.icon}" style="margin-right:8px; color:#aaa;"></i> ${app.name}</div>
                <div class="window-controls"><div class="win-max" onclick="toggleMaximize('${id}')"></div><div class="win-min" onclick="minimize('${id}')"></div><div class="win-close" onclick="closeWindow('${id}')"></div></div>`;
            
            const content = document.createElement('div'); content.className = 'window-content';
            if (customContent) content.innerHTML = customContent;
            else if (app.isSystem) {
                if(app.id === 'term') content.innerHTML = renderTerminal();
                else content.innerHTML = `<div class="internal-app">System App: ${app.name} loaded.</div>`;
            } else content.innerHTML = `<iframe src="${app.url}"></iframe>`;

            win.appendChild(header); win.appendChild(content); document.body.appendChild(win);

            const tbItem = document.createElement('div'); tbItem.className = 'taskbar-item active'; tbItem.id = 'tb-' + id;
            tbItem.innerHTML = `<i class="${app.icon}"></i><div class="taskbar-close" onclick="closeTaskbarApp(event, '${id}')"><i class="fa-solid fa-xmark"></i></div>`;
            tbItem.onclick = () => {
                const w = document.getElementById(id);
                if(w.style.display === 'none') { w.style.display = 'flex'; w.style.zIndex = ++zIndexCounter; tbItem.classList.add('active'); }
                else { if (parseInt(w.style.zIndex) === zIndexCounter) minimize(id); else w.style.zIndex = ++zIndexCounter; }
            };
            document.getElementById('taskbar-apps').appendChild(tbItem);
            makeDraggable(win, header);
            win.addEventListener('mousedown', () => { win.style.zIndex = ++zIndexCounter; document.querySelectorAll('.taskbar-item').forEach(el => el.classList.remove('active')); if(document.getElementById('tb-' + id)) document.getElementById('tb-' + id).classList.add('active'); });
        }

        function closeTaskbarApp(e, id) { e.stopPropagation(); closeWindow(id); }
        function closeWindow(id) { const win = document.getElementById(id); if(win) win.remove(); const tb = document.getElementById('tb-' + id); if(tb) tb.remove(); }
        function minimize(id) { document.getElementById(id).style.display = 'none'; document.getElementById('tb-' + id).classList.remove('active'); }
        function toggleMaximize(id) {
            const win = document.getElementById(id);
            if (win.dataset.state === 'maximized') {
                win.style.width = win.dataset.prevWidth; win.style.height = win.dataset.prevHeight; win.style.top = win.dataset.prevTop; win.style.left = win.dataset.prevLeft;
                win.dataset.state = 'normal'; win.style.borderRadius = '10px';
            } else {
                win.dataset.prevWidth = win.style.width; win.dataset.prevHeight = win.style.height; win.dataset.prevTop = win.style.top; win.dataset.prevLeft = win.style.left;
                win.style.width = '100%'; win.style.height = 'calc(100% - 52px)'; win.style.top = '0'; win.style.left = '0'; win.dataset.state = 'maximized'; win.style.borderRadius = '0';
            }
        }

        function makeDraggable(element, handle) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0; const snapOverlay = document.getElementById('snap-overlay');
            handle.onmousedown = dragMouseDown;
            function dragMouseDown(e) { e.preventDefault(); pos3 = e.clientX; pos4 = e.clientY; element.classList.add('no-transition'); document.onmouseup = closeDragElement; document.onmousemove = elementDrag; if(element.dataset.state === 'maximized') { element.dataset.state = 'normal'; element.style.width = '700px'; element.style.height = '500px'; element.style.borderRadius = '10px'; } }
            function elementDrag(e) { e.preventDefault(); pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY; pos3 = e.clientX; pos4 = e.clientY; element.style.top = (element.offsetTop - pos2) + "px"; element.style.left = (element.offsetLeft - pos1) + "px"; snapOverlay.style.display = 'none'; if (e.clientX < 20) showSnap(0, 0, '50%', 'calc(100% - 52px)'); else if (e.clientX > window.innerWidth - 20) showSnap(0, '50%', '50%', 'calc(100% - 52px)'); }
            function showSnap(t, l, w, h) { snapOverlay.style.display = 'block'; snapOverlay.style.top = t; snapOverlay.style.left = l; snapOverlay.style.width = w; snapOverlay.style.height = h; }
            function closeDragElement(e) { document.onmouseup = null; document.onmousemove = null; snapOverlay.style.display = 'none'; element.classList.remove('no-transition'); if (e.clientX < 20) snapWindow(element, '0', '0', '50%', 'calc(100% - 52px)'); else if (e.clientX > window.innerWidth - 20) snapWindow(element, '0', '50%', '50%', 'calc(100% - 52px)'); }
            function snapWindow(el, t, l, w, h) { el.style.top = t; el.style.left = l; el.style.width = w; el.style.height = h; el.style.borderRadius = '0'; }
        }

        function renderTerminal() { return `<div class="internal-app" style="background:#0c0c0c; font-family: 'Consolas', monospace;" onclick="document.getElementById('term-input').focus()"><div class="terminal-output" id="term-output">EdulearnOS Terminal [v4.1]<br>(c) 2026 Edulearn Systems.<br>Type 'help' for commands.<br><br></div><div class="terminal-input-line"><span class="terminal-prompt">root@edulearn:~#</span><input type="text" id="term-input" autocomplete="off" onkeydown="handleTerm(event)"></div></div>`; }
       window.handleTerm = function(e) {
            if (e.key === 'Enter') {
                e.preventDefault(); 
                const val = e.target.value.trim(); 
                const output = document.getElementById('term-output');
                
                // Echo the command to the screen
                output.innerHTML += `<div style="margin-top:5px"><span style="color:var(--accent)">root@edulearn:~#</span> ${val}</div>`;
                
                const parts = val.split(' '); 
                const cmd = parts[0]; 
                
                if(cmd === 'help') {
                    output.innerHTML += `<div>Commands: help, clear, ls, date</div>`;
                }
                else if(cmd === 'clear') {
                    output.innerHTML = '';
                }
                // --- FIX STARTS HERE ---
                else if(cmd === 'ls') {
                    // Fetch the files created via the context menu
                    const storedFiles = JSON.parse(localStorage.getItem('edulearn_files')) || {};
                    const fileNames = Object.keys(storedFiles);
                    
                    if (fileNames.length > 0) {
                        // Join file names with spaces and display them
                        output.innerHTML += `<div style="color: #4a90e2; font-weight: bold;">${fileNames.join('&nbsp;&nbsp;&nbsp;')}</div>`;
                    } else {
                        output.innerHTML += `<div style="color: #888;">(directory empty)</div>`;
                    }
                }
                // --- FIX ENDS HERE ---
                else if(cmd === 'date') {
                    output.innerHTML += `<div>${new Date().toString()}</div>`;
                }
                else if(val !== '') {
                    output.innerHTML += `<div style="color:#ff5f56">bash: ${cmd}: command not found</div>`;
                }
                
                // Clear input and scroll to bottom
                e.target.value = ''; 
                const terminalApp = e.target.closest('.internal-app');
                if(terminalApp) terminalApp.scrollTop = terminalApp.scrollHeight;
            }
        }
    </script>
</body>
</html>
