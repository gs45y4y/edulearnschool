<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Edulearn | Studies</title>
	<link id="dynamic-favicon" rel="icon"
		href="https://cdn.classlink.com/production/launchpad/resources/images/favicon/favicon-32x32.png">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		/* --- CORE VARIABLES (DEEP BLACK & PURPLE THEME) --- */
		:root {
			--bg-body: #050505;
			--bg-sidebar: #0a0a0a;
			--bg-card: #111111;
			--border-color: #222;
			--accent: #c026d3;
			--accent-glow: rgba(192, 38, 211, 0.4);
			--text-main: #f5f5f5;
			--text-muted: #a3a3a3;
			--sidebar-width-collapsed: 60px;
			--sidebar-width-expanded: 220px;
		}

		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}

		body {
			font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
			background-color: var(--bg-body);
			color: var(--text-main);
			overflow: hidden;
			display: flex;
			height: 100vh;
			font-size: 13px;
			transition: background-color 0.3s, color 0.3s;
		}

		#particles-js {
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			z-index: 1;
			pointer-events: none;
			opacity: 0.4;
		}

		/* --- SIDEBAR --- */
		.sidebar {
			width: var(--sidebar-width-collapsed);
			height: 100vh;
			background-color: var(--bg-sidebar);
			border-right: 1px solid rgba(255, 255, 255, 0.05);
			display: flex;
			flex-direction: column;
			transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			z-index: 1000;
			box-shadow: 5px 0 30px rgba(0, 0, 0, 0.5);
			overflow: hidden;
			white-space: nowrap;
			backdrop-filter: blur(10px);
		}

		.sidebar:hover {
			width: var(--sidebar-width-expanded);
		}

		.brand {
			height: 60px;
			display: flex;
			align-items: center;
			padding: 0 16px;
			font-weight: 700;
			font-size: 14px;
			color: var(--text-main);
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
			margin-bottom: 10px;
			overflow: hidden;
			letter-spacing: 0.5px;
		}

		.brand i {
			min-width: 24px;
			font-size: 18px;
			margin-right: 12px;
			text-align: center;
			color: var(--accent);
		}

		.brand span {
			opacity: 0;
			transition: opacity 0.2s;
		}

		.sidebar:hover .brand span {
			opacity: 1;
			transition-delay: 0.1s;
		}

		.nav-link {
			display: flex;
			align-items: center;
			height: 44px;
			padding: 0 16px;
			color: var(--text-muted);
			text-decoration: none;
			cursor: pointer;
			transition: all 0.2s;
			position: relative;
			font-size: 13px;
			font-weight: 500;
		}

		.nav-link:hover,
		.nav-link.active {
			background-color: rgba(192, 38, 211, 0.1);
			color: var(--text-main);
		}

		.nav-link.active::before {
			content: '';
			position: absolute;
			left: 0;
			top: 0;
			height: 100%;
			width: 3px;
			background-color: var(--accent);
			box-shadow: 0 0 12px var(--accent);
		}

		.nav-link i {
			min-width: 24px;
			font-size: 16px;
			margin-right: 12px;
			text-align: center;
			transition: color 0.2s;
		}

		.nav-link:hover i {
			color: var(--accent);
		}

		.nav-link span {
			opacity: 0;
			transition: opacity 0.1s;
		}

		.sidebar:hover .nav-link span {
			opacity: 1;
			transition-delay: 0.1s;
		}

		.sidebar-footer {
			margin-top: auto;
			width: 100%;
			background: rgba(0, 0, 0, 0.3);
			border-top: 1px solid rgba(255, 255, 255, 0.05);
			display: flex;
			flex-direction: column;
			padding: 15px 0;
		}

		.stat-row {
			display: flex;
			align-items: center;
			justify-content: center;
			width: 100%;
			height: 30px;
			color: var(--text-muted);
			font-size: 11px;
			white-space: nowrap;
			overflow: hidden;
			transition: all 0.2s;
			padding: 0 4px;
		}

		.timer-row {
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
			margin-bottom: 8px;
			padding-bottom: 8px;
		}

		.sidebar:hover .stat-row {
			justify-content: flex-start;
			padding-left: 18px;
			font-size: 12px;
		}

		.stat-row i {
			min-width: 20px;
			text-align: center;
			font-size: 13px;
		}

		.stat-value {
			margin-left: 6px;
			font-weight: 600;
			color: var(--text-main);
			font-family: monospace;
		}

		.sidebar:hover .stat-row i {
			margin-right: 8px;
		}

		.stat-label {
			display: none;
			margin-left: 6px;
			font-weight: normal;
			color: #777;
		}

		.sidebar:hover .stat-label {
			display: inline;
		}

		.fps-high {
			color: #22c55e;
		}

		.fps-med {
			color: #eab308;
		}

		.fps-low {
			color: #ef4444;
		}

		.bat-high {
			color: #4caf50;
		}

		.bat-med {
			color: #ff9800;
		}

		.bat-low {
			color: #f44336;
		}

		.bat-charge {
			color: #2196f3;
		}

		/* --- MAIN CONTENT --- */
		.main-content {
			flex: 1;
			position: relative;
			height: 100vh;
			overflow: hidden;
			padding: 0;
			z-index: 10;
		}

		.page {
			display: none;
			width: 100%;
			height: 100%;
			animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
			flex-direction: column;
		}

		.page.active {
			display: flex;
		}

		.home-container {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			height: 100%;
			text-align: center;
			padding: 20px;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: scale(0.98);
			}

			to {
				opacity: 1;
				transform: scale(1);
			}
		}

		#hero-title {
			font-size: 72px;
			margin-bottom: 8px;
			text-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
			font-weight: 800;
			letter-spacing: -2px;
			line-height: 1;
			background: linear-gradient(180deg, #fff, #aaa);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
		}

		.hero-subtitle {
			color: var(--text-muted);
			font-size: 18px;
			margin-bottom: 12px;
			letter-spacing: 0.5px;
			font-weight: 400;
		}

		.hero-quote {
			color: #666;
			font-size: 14px;
			font-style: italic;
			margin-bottom: 50px;
			font-family: 'Courier New', monospace;
			min-height: 20px;
			z-index: 2;
			opacity: 0.7;
		}

		.clock-container {
			text-align: center;
			user-select: none;
			margin-bottom: 50px;
		}

		.clock-time {
			font-size: 42px;
			font-weight: 200;
			color: var(--text-main);
			text-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
			letter-spacing: 3px;
			margin-bottom: 5px;
		}

		.clock-date {
			font-size: 14px;
			color: var(--text-muted);
			text-transform: uppercase;
			letter-spacing: 2px;
			font-weight: 600;
		}

		.start-btn {
			background-color: var(--accent);
			color: #ffffff;
			padding: 16px 50px;
			border-radius: 100px;
			font-size: 15px;
			font-weight: 800;
			text-decoration: none;
			border: none;
			cursor: pointer;
			box-shadow: 0 10px 40px -10px rgba(192, 38, 211, 0.3);
			transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
			display: inline-flex;
			align-items: center;
			gap: 12px;
			text-transform: uppercase;
			letter-spacing: 1px;
		}

		.start-btn:hover {
			transform: translateY(-4px) scale(1.05);
			box-shadow: 0 20px 50px -10px rgba(192, 38, 211, 0.5);
		}

		.iframe-wrapper {
			flex: 1;
			width: 100%;
			height: 100%;
			background: #000;
		}

		iframe {
			width: 100%;
			height: 100%;
			border: none;
		}

		/* --- SETTINGS MODAL --- */
		.modal-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.8);
			z-index: 2000;
			display: none;
			justify-content: center;
			align-items: center;
			backdrop-filter: blur(12px);
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		.modal-overlay.active {
			display: flex;
			opacity: 1;
		}

		.settings-container {
			width: 900px;
			height: 600px;
			background: #080808;
			border: 1px solid #222;
			border-radius: 16px;
			display: flex;
			overflow: hidden;
			box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.8);
			color: var(--text-main);
			position: relative;
		}

		.close-modal {
			position: absolute;
			top: 20px;
			right: 20px;
			color: #666;
			cursor: pointer;
			font-size: 20px;
			z-index: 10;
		}

		.close-modal:hover {
			color: #fff;
		}

		.settings-nav {
			width: 220px;
			background: #0c0c0c;
			border-right: 1px solid #222;
			padding: 20px 0;
			display: flex;
			flex-direction: column;
		}

		.settings-nav-header {
			padding: 0 24px 15px;
			font-size: 20px;
			font-weight: 700;
			color: #fff;
			border-bottom: 1px solid #222;
			margin-bottom: 10px;
		}

		.settings-nav-item {
			padding: 14px 24px;
			color: var(--text-muted);
			cursor: pointer;
			font-weight: 600;
			font-size: 13px;
			display: flex;
			align-items: center;
			gap: 10px;
			border-left: 3px solid transparent;
			transition: 0.2s;
		}

		.settings-nav-item:hover {
			color: #fff;
			background: rgba(255, 255, 255, 0.02);
		}

		.settings-nav-item.active {
			color: #fff;
			background: rgba(192, 38, 211, 0.05);
			border-left-color: var(--accent);
		}

		.settings-content {
			flex: 1;
			padding: 40px;
			overflow-y: auto;
			/* Added spacing to prevent overlap */
			display: flex;
			flex-direction: column;
			gap: 10px;
		}

		.settings-tab {
			display: none;
		}

		.settings-tab.active {
			display: block;
			animation: fadeIn 0.3s;
		}

		.section-title {
			font-size: 24px;
			font-weight: 700;
			margin-bottom: 10px;
		}

		.section-desc {
			color: var(--text-muted);
			margin-bottom: 30px;
			font-size: 14px;
		}

		.card {
			background: #111;
			border: 1px solid #222;
			border-radius: 12px;
			padding: 20px;
			margin-bottom: 20px;
		}

		.card h3 {
			font-size: 16px;
			font-weight: 600;
			margin-bottom: 8px;
			color: #fff;
		}

		.card p {
			font-size: 13px;
			color: #888;
			margin-bottom: 20px;
			line-height: 1.5;
		}

		.toggle-row {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-top: 15px;
		}

		.toggle-switch {
			position: relative;
			display: inline-block;
			width: 50px;
			height: 26px;
		}

		.toggle-switch input {
			opacity: 0;
			width: 0;
			height: 0;
		}

		.slider {
			position: absolute;
			cursor: pointer;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: #333;
			transition: .4s;
			border-radius: 34px;
		}

		.slider:before {
			position: absolute;
			content: "";
			height: 20px;
			width: 20px;
			left: 3px;
			bottom: 3px;
			background-color: white;
			transition: .4s;
			border-radius: 50%;
		}

		input:checked+.slider {
			background-color: var(--accent);
		}

		input:checked+.slider:before {
			transform: translateX(24px);
		}

		.btn {
			padding: 12px;
			border-radius: 8px;
			border: 1px solid #333;
			background: #1a1a1a;
			color: #fff;
			cursor: pointer;
			font-weight: 600;
			font-size: 13px;
			transition: 0.2s;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
		}

		.btn:hover {
			background: #252525;
			border-color: #444;
		}

		.btn-primary {
			background: var(--accent);
			border: none;
			color: white;
		}

		.btn-primary:hover {
			background: #d946ef;
		}

		.preset-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
		}

		.preset-btn {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 8px;
			padding: 15px;
			background: #050505;
			border: 1px solid #333;
			border-radius: 8px;
			cursor: pointer;
			color: #888;
			transition: 0.2s;
		}

		.preset-btn:hover {
			border-color: var(--accent);
			color: #fff;
		}

		input[type="text"],
		input[type="url"],
		select {
			width: 100%;
			padding: 12px 16px;
			background: rgba(0, 0, 0, 0.3);
			border: 1px solid rgba(255, 255, 255, 0.1);
			color: var(--text-main);
			border-radius: 8px;
			outline: none;
			font-size: 13px;
			transition: all 0.2s;
			margin-top: 5px;
		}

		input:focus,
		select:focus {
			border-color: var(--accent);
			background: rgba(0, 0, 0, 0.5);
		}

		.updates-modal-box {
			background: rgba(17, 17, 17, 0.95);
			width: 400px;
			border-radius: 16px;
			border: 1px solid rgba(255, 255, 255, 0.08);
			padding: 24px;
			box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
			color: var(--text-main);
		}
	</style>
</head>

<body>
	<canvas id="particles-js"></canvas>

	<nav class="sidebar">
		<div class="brand">
			<i class="fa-solid fa-ghost"></i>
			<span>Edulearn Lite</span>
		</div>
		<a class="nav-link active" onclick="switchPage('home', this)">
			<i class="fa-solid fa-house"></i>
			<span>Home</span>
		</a>
		<a class="nav-link" onclick="switchPage('games-page', this)">
			<i class="fa-solid fa-gamepad"></i>
			<span>Games</span>
		</a>
		<a class="nav-link" onclick="switchPage('search-page', this)">
			<i class="fa-solid fa-magnifying-glass"></i>
			<span>Search</span>
		</a>
		<a class="nav-link" onclick="switchPage('tools-page', this)">
			<i class="fa-solid fa-wrench"></i>
			<span>Tools</span>
		</a>
		<a class="nav-link" onclick="openUpdates()">
			<i class="fa-solid fa-newspaper"></i>
			<span>Updates</span>
		</a>
		<a class="nav-link" onclick="switchPage('info-page', this)">
			<i class="fa-solid fa-circle-info"></i>
			<span>Info</span>
		</a>
		<a class="nav-link" onclick="openSettings()">
			<i class="fa-solid fa-gear"></i>
			<span>Settings</span>
		</a>
		<a class="nav-link" onclick="switchPage('extras-page', this)">
			<i class="fa-solid fa-plus"></i>
			<span>Extras</span>
		</a>
		<div style="flex-grow: 1;"></div>
		<div class="sidebar-footer">
			<div class="stat-row timer-row">
				<i class="fa-solid fa-stopwatch"></i>
				<span id="game-timer" class="stat-value">00:00</span>
				<span class="stat-label">Session</span>
			</div>
			<div class="stat-row">
				<i class="fa-solid fa-gauge-high"></i>
				<span id="fps-display" class="stat-value">--</span>
				<span class="stat-label">FPS</span>
			</div>
			<div class="stat-row">
				<i class="fa-solid fa-user-group" style="color:#4caf50;"></i>
				<span id="online-count" class="stat-value">0</span>
				<span class="stat-label">online</span>
			</div>
			<div class="stat-row">
				<i id="bat-icon" class="fa-solid fa-battery-full"></i>
				<span id="battery-level" class="stat-value">--%</span>
				<span class="stat-label">Battery</span>
			</div>
		</div>
	</nav>

	<main class="main-content">
		<section id="home" class="page active">
			<div class="home-container">
				<h1 id="hero-title">Edulearn Lite</h1>
				<p class="hero-subtitle">The cleanest unblocked experience.</p>
				<p class="hero-quote" id="random-quote">"coded by the skids, for the skids"</p>
				<div class="clock-container">
					<div class="clock-time" id="clock-time">00:00:00</div>
					<div class="clock-date" id="clock-date">Loading Date...</div>
				</div>
				<button class="start-btn" onclick="startBrowsing()">
                    Start Gaming <i class="fa-solid fa-arrow-right"></i>
                </button>
			</div>
		</section>

		<section id="games-page" class="page">
			<div class="iframe-wrapper"><iframe src="./math/gn-math.html"></iframe></div>
		</section>
		<section id="search-page" class="page">
			<div class="iframe-wrapper"><iframe src="./active/index.html"></iframe></div>
		</section>
		<section id="tools-page" class="page">
			<div class="iframe-wrapper"><iframe src="./tools.html"></iframe></div>
		</section>
		<section id="info-page" class="page">
			<div class="iframe-wrapper"><iframe src="./info.html"></iframe></div>
		</section>
		<section id="extras-page" class="page">
			<div class="iframe-wrapper"><iframe src="./extras.html"></iframe></div>
		</section>
	</main>

	<div class="modal-overlay" id="settings-modal">
		<div class="settings-container">
			<i class="fa-solid fa-xmark close-modal" onclick="closeSettings()"></i>
			<div class="settings-nav">
				<div class="settings-nav-header">Settings</div>
				<div class="settings-nav-item active" onclick="switchSettingsTab('tab-cloaking', this)">
					<i class="fa-solid fa-mask"></i> Cloaking
				</div>
				<div class="settings-nav-item" onclick="switchSettingsTab('tab-panic', this)">
					<i class="fa-solid fa-triangle-exclamation"></i> Panic
				</div>
				<div class="settings-nav-item" onclick="switchSettingsTab('tab-appearance', this)">
					<i class="fa-solid fa-palette"></i> Appearance
				</div>
				<div class="settings-nav-item" onclick="switchSettingsTab('tab-data', this)">
					<i class="fa-solid fa-database"></i> Data
				</div>
				<div class="settings-nav-item" onclick="switchSettingsTab('tab-experiments', this)">
					<i class="fa-solid fa-flask"></i> Experiments
				</div>
			</div>

			<div class="settings-content">
				<div id="tab-cloaking" class="settings-tab active">
					<div class="section-title">Cloaking</div>
					<div class="section-desc">Manage disguise and stealth settings.</div>
					<div class="card">
						<h3>About:Blank Launcher</h3>
						<div class="btn-group" style="display:flex; gap:10px;">
							<button class="btn btn-primary" onclick="openAboutBlank()" style="flex:1;">Launch About:Blank</button>
							<button class="btn" onclick="alert('Use about:blank for best results.')" style="flex:1;">Launch Blob</button>
						</div>
						<div class="toggle-row">
							<span>Auto-launch on open</span>
							<label class="toggle-switch">
                                <input type="checkbox" id="auto-cloak-toggle" onchange="toggleAutoCloak(this)">
                                <span class="slider"></span>
                            </label>
						</div>
					</div>
					<div class="card">
						<h3>Tab Disguise</h3>
						<div class="preset-grid">
							<div class="preset-btn"
								onclick="setDisguise('Google Drive', 'https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png')">
								<i class="fa-brands fa-google-drive"></i> Drive
							</div>
							<div class="preset-btn"
								onclick="setDisguise('Classes', 'https://ssl.gstatic.com/classroom/favicon.png')">
								<i class="fa-solid fa-chalkboard-user"></i> Class
							</div>
							<div class="preset-btn"
								onclick="setDisguise('Gmail', 'https://ssl.gstatic.com/ui/v1/icons/mail/rfr/gmail.ico')">
								<i class="fa-solid fa-envelope"></i> Gmail
							</div>
						</div>
						<input type="text" id="custom-title" placeholder="Custom Title..." onkeyup="updateCustomDisguise()">
						<input type="text" id="custom-icon" placeholder="Custom Icon URL..." onkeyup="updateCustomDisguise()">
                    </div>
					</div>

					<div id="tab-panic" class="settings-tab">
						<div class="section-title">Panic Button</div>
						<div class="section-desc">Safety features for emergency switching.</div>
						<div class="card">
							<h3>Panic Binding</h3>
							<input type="text" id="panic-key-display" placeholder="Click to bind..." readonly onclick="startBinding()">
							<input type="text" id="panic-url" value="https://launchpad.classlink.com" placeholder="Redirect URL" onchange="savePanicSettings()">
							<div class="toggle-row">
								<span>Enable Panic Key</span>
								<label class="toggle-switch">
                                <input type="checkbox" id="panic-toggle" onchange="savePanicSettings()">
                                <span class="slider"></span>
                            </label>
							</div>
						</div>
					</div>

					<div id="tab-appearance" class="settings-tab">
						<div class="section-title">Appearance</div>
						<div class="section-desc">Customize the UI.</div>
						<div class="card">
							<h3>Theme</h3>
							<select id="theme-select" onchange="changeTheme(this.value)">
                            <option value="midnight">Midnight Purple (Default)</option>
                            <option value="ocean">Ocean Blue</option>
                            <option value="sunset">Sunset Orange</option>
                            <option value="amoled">Pure Black</option>
                        </select>
						</div>
						<div class="card">
							<h3>Effects</h3>
							<div class="toggle-row">
								<span>Particles</span>
								<label class="toggle-switch">
                                <input type="checkbox" id="particle-toggle" checked onchange="toggleParticles(this)">
                                <span class="slider"></span>
                            </label>
							</div>
						</div>
					</div>

					<div id="tab-data" class="settings-tab">
						<div class="section-title">Data</div>
						<div class="card">
							<h3>Reset</h3>
							<p>Clear all saved settings and preferences.</p>
							<button class="btn" style="color:#ff8a80; border-color: #5c1818; background: #2a0a0a; width: 100%;" onclick="localStorage.removeItem('el_settings'); location.reload();">Reset All Data</button>
						</div>
					</div>

					<div id="tab-experiments" class="settings-tab">
						<div class="section-title">Experiments</div>
						<div class="section-desc">Beta features that may be unstable.</div>
						<div class="card">
							<h3>EdulearnOS</h3>
							<p>Switch the environment to the OS-style layout.</p>
							<div class="toggle-row">
								<span>Enable EdulearnOS</span>
								<label class="toggle-switch">
                                <input type="checkbox" id="edulearnos-toggle" onchange="toggleEdulearnOS(this)">
                                <span class="slider"></span>
                            </label>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="modal-overlay" id="updates-modal">
			<div class="updates-modal-box">
				<div
					style="display:flex; justify-content:space-between; margin-bottom:15px; font-size:18px; font-weight:700;">
					<span><i class="fa-solid fa-bullhorn" style="color:var(--accent);"></i> Updates</span>
					<i class="fa-solid fa-xmark close-btn" onclick="closeUpdates()" style="cursor:pointer;"></i>
				</div>
				<div style="margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:10px;">
					<span style="font-size:11px; color:#888; text-transform:uppercase;">Feb 5, 2026 - v5.3.1</span>
					<ul style="list-style:none; padding-left:10px; margin-top:5px; line-height:1.6;">
						<li>• Fixed Settings Overlap</li>
						<li>• Added EdulearnOS Experiment</li>
						<li>• Improved Modal Layout</li>
					</ul>
				</div>
				<button class="btn btn-primary" onclick="closeUpdates()" style="width:100%;">Got it!</button>
			</div>
		</div>

		<script>
			const defaultSettings = {
            title: 'Edulearn | Studies',
            icon: 'https://cdn.classlink.com/production/launchpad/resources/images/favicon/favicon-32x32.png',
            theme: 'midnight',
            particles: true,
            autoCloak: false,
            panicKey: '`',
            panicUrl: 'https://launchpad.classlink.com',
            panicEnabled: true
        };
        let userSettings = JSON.parse(localStorage.getItem('el_settings')) || defaultSettings;

        // Particles System
        const canvas = document.getElementById('particles-js');
        const ctx = canvas.getContext('2d');
        let particlesArray = [];
        let isAnimating = false;

        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 0.5;
                this.speedX = Math.random() * 0.4 - 0.2;
                this.speedY = Math.random() * 0.4 - 0.2;
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            update() {
                this.x += this.speedX; this.y += this.speedY;
                if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
            }
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
            }
        }

        function initParticles() {
            particlesArray = [];
            if (!userSettings.particles) { ctx.clearRect(0, 0, canvas.width, canvas.height); isAnimating = false; return; }
            for (let i = 0; i < 30; i++) particlesArray.push(new Particle());
            if (!isAnimating) { isAnimating = true; animateParticles(); }
        }

        function animateParticles() {
            if (!isAnimating || !userSettings.particles) { ctx.clearRect(0, 0, canvas.width, canvas.height); return; }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particlesArray.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }
        initParticles();

        function toggleParticles(cb) {
            userSettings.particles = cb.checked;
            saveSettings();
            initParticles();
        }

        // Navigation
        function switchPage(pageId, navElement) {
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if (navElement) {
                document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
                navElement.classList.add('active');
            }
            if (pageId === 'home') displayRandomQuote();
        }

        function startBrowsing() {
            switchPage('games-page');
            document.querySelectorAll('.nav-link')[1].classList.add('active');
        }

        function openUpdates() { document.getElementById('updates-modal').classList.add('active'); }
        function closeUpdates() { document.getElementById('updates-modal').classList.remove('active'); }

        function displayRandomQuote() {
            const quotes = ["coded by the skids, for the skids", "teachers hate ts", "unblocked and unlocked", "running on pure caffeine", "gaming freedom!", "vibecoded type shi"];
            document.getElementById('random-quote').innerText = '"' + quotes[Math.floor(Math.random() * quotes.length)] + '"';
        }
        displayRandomQuote();

        // Clock & Stats
        function updateClock() {
            const now = new Date();
            document.getElementById('clock-time').innerText = now.toLocaleTimeString();
            document.getElementById('clock-date').innerText = now.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        setInterval(updateClock, 1000); updateClock();

        let startTime = Date.now();
        setInterval(() => {
            let diff = Math.floor((Date.now() - startTime) / 1000);
            let m = Math.floor(diff / 60), s = diff % 60;
            document.getElementById('game-timer').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        }, 1000);

        let frameCount = 0, lastTime = performance.now();
        function updateFPS() {
            frameCount++; let now = performance.now();
            if (now - lastTime >= 1000) {
                let fps = frameCount; const fpsEl = document.getElementById('fps-display');
                fpsEl.innerText = fps; fpsEl.className = "stat-value " + (fps >= 50 ? 'fps-high' : (fps >= 30 ? 'fps-med' : 'fps-low'));
                frameCount = 0; lastTime = now;
            }
            requestAnimationFrame(updateFPS);
        }
        updateFPS();

        function updateBatteryUI(battery) {
            const level = Math.round(battery.level * 100);
            const icon = document.getElementById('bat-icon');
            document.getElementById('battery-level').innerText = level + '%';
            icon.className = "fa-solid " + (battery.charging ? "fa-bolt bat-charge" : (level > 50 ? "fa-battery-full bat-high" : (level > 20 ? "fa-battery-half bat-med" : "fa-battery-quarter bat-low")));
        }
        if (navigator.getBattery) navigator.getBattery().then(b => {
            updateBatteryUI(b); b.onlevelchange = () => updateBatteryUI(b); b.onchargingchange = () => updateBatteryUI(b);
        });

        // Settings Logic
        function openSettings() { document.getElementById('settings-modal').classList.add('active'); applySettingsInputs(); }
        function closeSettings() { document.getElementById('settings-modal').classList.remove('active'); }

        function switchSettingsTab(tabId, navItem) {
            document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.settings-nav-item').forEach(n => n.classList.remove('active'));
            navItem.classList.add('active');
        }

        function applySettingsInputs() {
            document.getElementById('auto-cloak-toggle').checked = userSettings.autoCloak;
            document.getElementById('panic-toggle').checked = userSettings.panicEnabled;
            document.getElementById('panic-key-display').value = userSettings.panicKey;
            document.getElementById('panic-url').value = userSettings.panicUrl;
            document.getElementById('custom-title').value = userSettings.title;
            document.getElementById('custom-icon').value = userSettings.icon;
            document.getElementById('theme-select').value = userSettings.theme;
            document.getElementById('particle-toggle').checked = userSettings.particles;
            document.getElementById('edulearnos-toggle').checked = false;
        }

        function saveSettings() { localStorage.setItem('el_settings', JSON.stringify(userSettings)); }

        function changeTheme(val) { userSettings.theme = val; saveSettings(); applyTheme(val); }

        function applyTheme(themeName) {
            const root = document.documentElement.style;
            if (themeName === 'ocean') { root.setProperty('--bg-body', '#0f172a'); root.setProperty('--bg-sidebar', '#1e293b'); root.setProperty('--accent', '#38bdf8'); }
            else if (themeName === 'sunset') { root.setProperty('--bg-body', '#2a0a0a'); root.setProperty('--bg-sidebar', '#3f1010'); root.setProperty('--accent', '#f97316'); }
            else if (themeName === 'amoled') { root.setProperty('--bg-body', '#000000'); root.setProperty('--bg-sidebar', '#000000'); root.setProperty('--accent', '#ffffff'); }
            else { root.setProperty('--bg-body', '#050505'); root.setProperty('--bg-sidebar', '#0a0a0a'); root.setProperty('--accent', '#c026d3'); }
        }

        function setDisguise(title, icon) { userSettings.title = title; userSettings.icon = icon; saveSettings(); updateDisguise(); applySettingsInputs(); }
        function updateCustomDisguise() { userSettings.title = document.getElementById('custom-title').value || "Edulearn | Studies"; userSettings.icon = document.getElementById('custom-icon').value || "https://cdn.classlink.com/production/launchpad/resources/images/favicon/favicon-32x32.png"; saveSettings(); updateDisguise(); }
        function updateDisguise() { document.title = userSettings.title; document.getElementById('dynamic-favicon').href = userSettings.icon; }

        function openAboutBlank() {
            let win = window.open(); if (!win) return alert("Popups blocked.");
            let iframe = win.document.createElement('iframe');
            iframe.style = "position:fixed;top:0;left:0;width:100%;height:100%;border:none;";
            iframe.src = window.location.href; win.document.body.appendChild(iframe);
            win.document.title = userSettings.title;
            let link = win.document.createElement('link'); link.rel = 'icon'; link.href = userSettings.icon; win.document.head.appendChild(link);
        }

        function toggleAutoCloak(cb) { userSettings.autoCloak = cb.checked; saveSettings(); }

        // Experiments
        function toggleEdulearnOS(cb) {
            if (cb.checked) {
                
                window.location.href = "./x4konkor3.html";
            }
        }

        // Panic logic
        let isBinding = false;
        function startBinding() { const display = document.getElementById('panic-key-display'); display.value = "Press any key..."; display.style.border = "1px solid var(--accent)"; isBinding = true; }
        function savePanicSettings() { userSettings.panicUrl = document.getElementById('panic-url').value; userSettings.panicEnabled = document.getElementById('panic-toggle').checked; saveSettings(); }

        document.addEventListener('keydown', (e) => {
            if (isBinding) {
                e.preventDefault(); userSettings.panicKey = e.key;
                document.getElementById('panic-key-display').value = e.key;
                document.getElementById('panic-key-display').style.border = "";
                isBinding = false; saveSettings(); return;
            }
            if (userSettings.panicEnabled && e.key === userSettings.panicKey) {
                if (document.activeElement.tagName === 'INPUT') return;
                window.open(userSettings.panicUrl, '_blank'); window.open('','_self').close(); window.location.replace("about:blank");
            }
        });

        window.onload = () => {
            applyTheme(userSettings.theme); updateDisguise();
            if (userSettings.autoCloak && window.self === window.top) openAboutBlank();
        };
		</script>
</body>

</html>