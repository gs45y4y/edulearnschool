<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Edulearn | Studies</title>
	<link id="dynamic-favicon" rel="icon"
		href="https://cdn.classlink.com/production/launchpad/resources/images/favicon/favicon-32x32.png">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		/* --- CORE VARIABLES --- */
		:root {
			/* Theme: Midnight Grey */
			--bg-body: #202020;
			--bg-sidebar: #2b2b2b;
			--accent: #ffffff;
			--text-main: #e0e0e0;
			--text-muted: #9e9e9e;
			--card-bg: #333333;
			--glow-text: 0 0 10px rgba(255, 255, 255, 0.2);
			--glow-strong: 0 0 20px rgba(255, 255, 255, 0.5);

			/* Background Overlay */
			--bg-overlay: 0.0;
			/* Default no dim */

			/* Sizing */
			--sidebar-width-collapsed: 54px;
			--sidebar-width-expanded: 200px;
			--nav-item-height: 40px;
		}

		/* --- RESET & BASE --- */
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}

		body {
			font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
			background-color: var(--bg-body);
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
			background-attachment: fixed;
			color: var(--text-main);
			overflow: hidden;
			display: flex;
			height: 100vh;
			font-size: 13px;
			transition: background-color 0.3s, color 0.3s;
			position: relative;
		}

		/* Background Dim Overlay */
		body::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, var(--bg-overlay));
			z-index: 0;
			pointer-events: none;
		}

		/* --- PARTICLES CANVAS --- */
		#particles-js {
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			z-index: 1;
			pointer-events: none;
			opacity: 0.4;
		}

		/* --- SIDEBAR NAVIGATION --- */
		.sidebar {
			width: var(--sidebar-width-collapsed);
			height: 100vh;
			background-color: var(--bg-sidebar);
			border-right: 1px solid #3a3a3a;
			display: flex;
			flex-direction: column;
			transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			z-index: 1000;
			box-shadow: 5px 0 20px rgba(0, 0, 0, 0.3);
			overflow: hidden;
			white-space: nowrap;
		}

		.sidebar:hover {
			width: var(--sidebar-width-expanded);
		}

		.brand {
			height: 50px;
			display: flex;
			align-items: center;
			padding: 0 14px;
			font-weight: bold;
			font-size: 14px;
			color: var(--text-main);
			text-shadow: var(--glow-text);
			border-bottom: 1px solid #3a3a3a;
			margin-bottom: 5px;
			overflow: hidden;
		}

		.brand i {
			min-width: 24px;
			font-size: 16px;
			margin-right: 10px;
			text-align: center;
		}

		.brand span {
			opacity: 0;
			transition: opacity 0.2s;
		}

		.sidebar:hover .brand span {
			opacity: 1;
			transition-delay: 0.1s;
		}

		.nav-link {
			display: flex;
			align-items: center;
			height: var(--nav-item-height);
			padding: 0 14px;
			color: var(--text-muted);
			text-decoration: none;
			cursor: pointer;
			transition: all 0.2s;
			position: relative;
			font-size: 12px;
		}

		.nav-link:hover,
		.nav-link.active {
			background-color: rgba(255, 255, 255, 0.08);
			color: var(--text-main);
		}

		.nav-link.active::before {
			content: '';
			position: absolute;
			left: 0;
			top: 0;
			height: 100%;
			width: 3px;
			background-color: var(--accent);
			box-shadow: 0 0 8px var(--accent);
		}

		.nav-link i {
			min-width: 24px;
			font-size: 16px;
			margin-right: 10px;
			text-align: center;
		}

		.nav-link span {
			opacity: 0;
			transition: opacity 0.1s;
		}

		.sidebar:hover .nav-link span {
			opacity: 1;
			transition-delay: 0.1s;
		}

		/* --- FOOTER STATS --- */
		.sidebar-footer {
			margin-top: auto;
			width: 100%;
			background: rgba(0, 0, 0, 0.2);
			border-top: 1px solid #3a3a3a;
			display: flex;
			flex-direction: column;
			padding: 10px 0;
		}

		.stat-row {
			display: flex;
			align-items: center;
			justify-content: center;
			width: 100%;
			height: 28px;
			color: var(--text-muted);
			font-size: 11px;
			white-space: nowrap;
			overflow: hidden;
			transition: all 0.2s;
			padding: 0 2px;
		}

		.timer-row {
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
			margin-bottom: 5px;
			padding-bottom: 5px;
		}

		.sidebar:hover .stat-row {
			justify-content: flex-start;
			padding-left: 18px;
			font-size: 12px;
		}

		.stat-row i {
			min-width: 20px;
			text-align: center;
			font-size: 13px;
		}

		.stat-value {
			margin-left: 4px;
			font-weight: 600;
			color: var(--text-main);
		}

		.sidebar:hover .stat-row i {
			margin-right: 8px;
		}

		.stat-label {
			display: none;
			margin-left: 4px;
			font-weight: normal;
			color: #777;
		}

		.sidebar:hover .stat-label {
			display: inline;
		}

		/* Battery Colors */
		.bat-high {
			color: #4caf50;
		}

		.bat-med {
			color: #ff9800;
		}

		.bat-low {
			color: #f44336;
		}

		.bat-charge {
			color: #2196f3;
		}


		/* --- MAIN CONTENT --- */
		.main-content {
			flex: 1;
			position: relative;
			height: 100vh;
			overflow: hidden;
			padding: 0;
			z-index: 10;
		}

		.page {
			display: none;
			width: 100%;
			height: 100%;
			animation: fadeIn 0.3s ease;
			flex-direction: column;
		}

		.page.active {
			display: flex;
		}

		.home-container {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			height: 100%;
			text-align: center;
			padding: 20px;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: scale(0.99);
			}

			to {
				opacity: 1;
				transform: scale(1);
			}
		}

		/* --- HERO TEXT --- */
		#hero-title {
			font-size: 64px;
			margin-bottom: 5px;
			text-shadow: var(--glow-strong);
			font-weight: 600;
			letter-spacing: -1px;
			line-height: 1.1;
		}

		.hero-subtitle {
			color: var(--text-muted);
			font-size: 16px;
			margin-bottom: 10px;
			letter-spacing: 0.5px;
		}

		.hero-quote {
			color: #666;
			font-size: 13px;
			font-style: italic;
			margin-bottom: 40px;
			font-family: monospace;
			min-height: 20px;
			z-index: 2;
			text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
		}

		.clock-container {
			text-align: center;
			user-select: none;
			opacity: 0.9;
			margin-bottom: 40px;
		}

		.clock-time {
			font-size: 36px;
			font-weight: 300;
			color: var(--text-main);
			text-shadow: var(--glow-text);
			letter-spacing: 2px;
			margin-bottom: 5px;
		}

		.clock-date {
			font-size: 14px;
			color: var(--text-muted);
			text-transform: uppercase;
			letter-spacing: 1px;
		}

		/* Start Button */
		.start-btn {
			background-color: var(--accent);
			color: #222;
			padding: 14px 40px;
			border-radius: 50px;
			font-size: 16px;
			font-weight: 600;
			text-decoration: none;
			border: none;
			cursor: pointer;
			box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
			transition: all 0.2s ease;
			display: inline-flex;
			align-items: center;
			gap: 10px;
		}

		.start-btn:hover {
			transform: scale(1.05);
			box-shadow: 0 0 25px rgba(255, 255, 255, 0.4);
		}

		/* --- IFRAME WRAPPER --- */
		.iframe-wrapper {
			flex: 1;
			width: 100%;
			height: 100%;
			background: #111;
			border-radius: 0;
			border: none;
			box-shadow: none;
			overflow: hidden;
		}

		iframe {
			width: 100%;
			height: 100%;
			border: none;
			display: block;
		}

		/* --- SETTINGS MODAL --- */
		.modal-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.7);
			z-index: 2000;
			display: none;
			justify-content: center;
			align-items: center;
			backdrop-filter: blur(5px);
		}

		.modal-overlay.active {
			display: flex;
		}

		.modal-box {
			background: var(--bg-sidebar);
			width: 450px;
			border-radius: 8px;
			border: 1px solid #444;
			padding: 0;
			box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
			color: var(--text-main);
			display: flex;
			flex-direction: column;
			overflow: hidden;
		}

		.modal-header {
			padding: 15px 20px;
			border-bottom: 1px solid #3a3a3a;
			display: flex;
			justify-content: space-between;
			font-weight: bold;
			background: rgba(255, 255, 255, 0.05);
		}

		.close-btn {
			cursor: pointer;
			color: #888;
		}

		.close-btn:hover {
			color: #fff;
		}

		.modal-body {
			padding: 20px;
			max-height: 400px;
			overflow-y: auto;
		}

		.setting-group {
			margin-bottom: 20px;
			padding-bottom: 20px;
			border-bottom: 1px solid #3a3a3a;
		}

		.setting-group:last-child {
			border-bottom: none;
		}

		.setting-label {
			display: block;
			font-size: 12px;
			color: var(--text-muted);
			margin-bottom: 6px;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		input[type="text"],
		select {
			width: 100%;
			padding: 10px;
			background: rgba(0, 0, 0, 0.2);
			border: 1px solid #555;
			color: var(--text-main);
			border-radius: 4px;
			outline: none;
			font-size: 13px;
		}

		input[type="text"]:focus {
			border-color: var(--accent);
		}

		.btn {
			background: #333;
			color: white;
			border: none;
			padding: 10px 16px;
			border-radius: 4px;
			cursor: pointer;
			font-size: 12px;
			transition: background 0.2s;
			width: 100%;
			text-align: center;
			margin-bottom: 10px;
			display: inline-block;
		}

		.btn:hover {
			background: #444;
		}

		.btn-primary {
			background: var(--accent);
			color: #111;
			font-weight: bold;
		}

		.btn-danger {
			background: #d32f2f;
			color: #fff;
		}

		.btn-danger:hover {
			background: #b71c1c;
		}

		.range-wrap {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		input[type="range"] {
			flex: 1;
		}

		.info-text {
			font-size: 11px;
			color: #666;
			margin-top: 5px;
			line-height: 1.4;
		}

		.upload-row {
			display: flex;
			gap: 10px;
			align-items: center;
		}
	</style>
</head>

<body>

	<canvas id="particles-js"></canvas>

	<nav class="sidebar">
		<div class="brand">
			<i class="fa-solid fa-ghost"></i>
			<span>Edulearn Lite</span>
		</div>

		<a class="nav-link active" onclick="switchPage('home', this)">
			<i class="fa-solid fa-house"></i>
			<span>Home</span>
		</a>
		<a class="nav-link" onclick="switchPage('games-page', this)">
			<i class="fa-solid fa-gamepad"></i>
			<span>Games</span>
		</a>
		<a class="nav-link" onclick="switchPage('search-page', this)">
			<i class="fa-solid fa-magnifying-glass"></i>
			<span>Search</span>
		</a>
		<a class="nav-link" onclick="switchPage('tools-page', this)">
			<i class="fa-solid fa-wrench"></i>
			<span>Tools</span>
		</a>

		<a class="nav-link" onclick="switchPage('info-page', this)">
			<i class="fa-solid fa-circle-info"></i>
			<span>Info</span>
		</a>

		<a class="nav-link" onclick="openSettings()">
			<i class="fa-solid fa-gear"></i>
			<span>Settings</span>
		</a>

		<div style="flex-grow: 1;"></div>

		<div class="sidebar-footer">
			<div class="stat-row timer-row">
				<i class="fa-solid fa-stopwatch"></i>
				<span id="game-timer" class="stat-value">00:00</span>
				<span class="stat-label">Session</span>
			</div>
			<div class="stat-row">
				<i class="fa-solid fa-user-group" style="color:#4caf50;"></i>
				<span id="online-count" class="stat-value">0</span>
				<span class="stat-label">online</span>
			</div>
			<div class="stat-row">
				<i id="bat-icon" class="fa-solid fa-battery-full"></i>
				<span id="battery-level" class="stat-value">--%</span>
				<span class="stat-label">Battery</span>
			</div>
		</div>
	</nav>

	<main class="main-content">

		<section id="home" class="page active">
			<div class="home-container">

				<h1 id="hero-title">Edulearn Lite</h1>
				<p class="hero-subtitle">The cleanest unblocked experience.</p>

				<p class="hero-quote" id="random-quote">"coded by the skids, for the skids"</p>

				<div class="clock-container">
					<div class="clock-time" id="clock-time">00:00:00</div>
					<div class="clock-date" id="clock-date">Loading Date...</div>
				</div>

				<button class="start-btn" onclick="startBrowsing()">
                    Start Gaming <i class="fa-solid fa-arrow-right"></i>
                </button>
			</div>
		</section>

		<section id="games-page" class="page">
			<div class="iframe-wrapper">
				<iframe src="./math/gn-math.html"></iframe>
			</div>
		</section>

		<section id="search-page" class="page">
			<div class="iframe-wrapper">
				<iframe src="./active/index.html"></iframe>
			</div>
		</section>
		<section id="tools-page" class="page">
			<div class="iframe-wrapper">
				<iframe src="./tools.html"></iframe>
			</div>
		</section>

		<section id="info-page" class="page">
			<div class="iframe-wrapper">
				<iframe id="info-frame" src=""></iframe>
			</div>
		</section>
	</main>

	<div class="modal-overlay" id="settings-modal">
		<div class="modal-box">
			<div class="modal-header">
				<span><i class="fa-solid fa-sliders" style="margin-right:10px;"></i>Config</span>
				<i class="fa-solid fa-xmark close-btn" onclick="closeSettings()"></i>
			</div>

			<div class="modal-body">
				<div class="setting-group">
					<span class="setting-label">Tab Cloaking</span>
					<input type="text" id="input-title" placeholder="Tab Title" onkeyup="updateTab()" style="margin-bottom: 10px;">
					<input type="text" id="input-icon" placeholder="Tab Icon URL" onkeyup="updateTab()">
                </div>

					<div class="setting-group">
						<span class="setting-label">Theme & Background</span>

						<select id="theme-select" onchange="changeTheme(this.value)" style="margin-bottom: 15px;">
                        <option value="midnight">Midnight Grey (Default)</option>
                        <option value="ocean">Ocean Blue</option>
                        <option value="sunset">Sunset Orange</option>
                        <option value="amoled">Pure Black</option>
                    </select>

						<span class="setting-label">Background Image</span>
						<select id="bg-preset" onchange="changeBgPreset(this.value)" style="margin-bottom: 10px;">
                        <option value="none">None (Use Theme Color)</option>
                        <option value="space">OS Icelandic theme</option>
                        <option value="mountain">Alpine Mountains</option>
                        <option value="city">Cyberpunk City</option>
                        <option value="abstract">Dark Abstract</option>
                    </select>

						<div class="upload-row" style="margin-bottom: 15px;">
							<label class="btn" style="flex:1; margin:0; display:flex; align-items:center; justify-content:center; gap:5px;">
                            <i class="fa-solid fa-upload"></i> Upload File
                            <input type="file" id="bg-upload" accept="image/*" style="display:none" onchange="handleBgUpload(this)">
                        </label>
							<button class="btn btn-danger" style="width:auto; margin:0;" onclick="clearBackground()" title="Remove Background">
                            <i class="fa-solid fa-trash"></i>
                        </button>
						</div>

						<span class="setting-label">Background Dimming: <span id="dim-val">0%</span></span>
						<div class="range-wrap">
							<input type="range" id="dim-slider" min="0" max="90" value="0" oninput="updateBgDim(this.value)">
                    </div>
						</div>

						<div class="setting-group">
							<span class="setting-label">Particle Density: <span id="particle-val">20</span></span>
							<div class="range-wrap">
								<input type="range" id="particle-slider" min="0" max="80" value="20" oninput="updateParticlesRealtime(this.value)">
                    </div>
							</div>

							<div class="setting-group">
								<span class="setting-label">System Info</span>
								<p class="info-text">
									Analytics: <span style="color:#4caf50">Active (vercel)</span><br>
                        Session: <span id="session-display">00:00</span>
								</p>
							</div>

							<div>
								<button class="btn btn-primary" onclick="openAboutBlank()">Open in About:Blank</button>
								<button class="btn" onclick="saveSettings()">Save Configuration</button>
							</div>
						</div>
					</div>
				</div>

				<script>
					// --- 1. STATE MANAGEMENT ---
    const defaultSettings = {
      title: 'Edulearn | Studies',
      icon: 'https://cdn.classlink.com/production/launchpad/resources/images/favicon/favicon-32x32.png',
      theme: 'midnight',
      particles: 20,
      bgImage: null, // Custom Base64 or URL
      bgPreset: 'none',
      bgDim: 0
    };

    let userSettings = JSON.parse(localStorage.getItem('el_settings')) || defaultSettings;

    // --- 2. PARTICLES SYSTEM ---
    const canvas = document.getElementById('particles-js');
    const ctx = canvas.getContext('2d');
    let particlesArray = [];
    let isAnimating = false;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Particle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2 + 0.5;
        this.speedX = Math.random() * 0.4 - 0.2;
        this.speedY = Math.random() * 0.4 - 0.2;
        this.opacity = Math.random() * 0.5 + 0.1;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
        if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
      }
      draw() {
        ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function initParticles() {
      particlesArray = [];
      let count = parseInt(userSettings.particles);
      if (count > 100) count = 100;

      for (let i = 0; i < count; i++) {
        particlesArray.push(new Particle());
      }

      if (count > 0 && !isAnimating) {
        isAnimating = true;
        animateParticles();
      } else if (count === 0) {
        isAnimating = false;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }

    function animateParticles() {
      if (!isAnimating) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < particlesArray.length; i++) {
        particlesArray[i].update();
        particlesArray[i].draw();
      }
      requestAnimationFrame(animateParticles);
    }
    initParticles();


    // --- 3. BACKGROUND LOGIC ---
    const bgPresets = {
        space: "https://www.usnews.com/object/image/00000162-f3a3-d0d5-a57f-fbf33c300000/3-vestrahorn-iceland.jpg?update-time=1745871301820&size=responsive970",
        mountain: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&w=1920&q=80",
        city: "https://images.unsplash.com/photo-1555680202-c86f0e12f086?auto=format&fit=crop&w=1920&q=80",
        abstract: "https://images.unsplash.com/photo-1550684848-fac1c5b4e853?auto=format&fit=crop&w=1920&q=80"
    };

    function applyBackground() {
        const body = document.body;
        
        // 1. Handle Dimming
        const dimVal = userSettings.bgDim || 0;
        document.documentElement.style.setProperty('--bg-overlay', dimVal / 100);
        document.getElementById('dim-slider').value = dimVal;
        document.getElementById('dim-val').innerText = dimVal + "%";

        // 2. Determine Image Source
        let src = null;
        
        // Check Custom Upload first
        if (userSettings.bgImage) {
            src = userSettings.bgImage;
            document.getElementById('bg-preset').value = 'none'; // Reset preset dropdown visually
        } 
        // Check Preset
        else if (userSettings.bgPreset && userSettings.bgPreset !== 'none') {
            src = bgPresets[userSettings.bgPreset];
            document.getElementById('bg-preset').value = userSettings.bgPreset;
        } else {
            document.getElementById('bg-preset').value = 'none';
        }

        // 3. Apply
        if (src) {
            body.style.backgroundImage = `url('${src}')`;
        } else {
            body.style.backgroundImage = 'none';
        }
    }

    function handleBgUpload(input) {
        const file = input.files[0];
        if (!file) return;

        // Check size (limit to ~3MB to be safe for LocalStorage)
        if (file.size > 3000000) {
            alert("File is too large! Please choose an image under 3MB.");
            return;
        }

        const reader = new FileReader();
        reader.onloadend = function() {
            userSettings.bgImage = reader.result; // Base64 string
            userSettings.bgPreset = 'none'; // Clear preset
            applyBackground();
        }
        reader.readAsDataURL(file);
    }

    function changeBgPreset(val) {
        if (val === 'none') {
            userSettings.bgPreset = 'none';
            userSettings.bgImage = null; // Clear custom too if they purposely choose None
        } else {
            userSettings.bgPreset = val;
            userSettings.bgImage = null; // Preset overrides custom
        }
        applyBackground();
    }

    function clearBackground() {
        userSettings.bgImage = null;
        userSettings.bgPreset = 'none';
        applyBackground();
    }

    function updateBgDim(val) {
        userSettings.bgDim = val;
        document.documentElement.style.setProperty('--bg-overlay', val / 100);
        document.getElementById('dim-val').innerText = val + "%";
    }


    // --- 4. SETTINGS & THEME ---

    function applySettings() {
      document.title = userSettings.title;
      document.getElementById('dynamic-favicon').href = userSettings.icon;

      document.getElementById('input-title').value = userSettings.title;
      document.getElementById('input-icon').value = userSettings.icon;
      document.getElementById('theme-select').value = userSettings.theme;
      document.getElementById('particle-slider').value = userSettings.particles;
      document.getElementById('particle-val').innerText = userSettings.particles;

      updateTheme(userSettings.theme);
      applyBackground(); // Apply BG
    }

    function updateTheme(themeName) {
      const root = document.documentElement.style;
      if (themeName === 'ocean') {
        root.setProperty('--bg-body', '#0f172a');
        root.setProperty('--bg-sidebar', '#1e293b');
        root.setProperty('--accent', '#38bdf8');
        root.setProperty('--glow-text', '0 0 10px #38bdf8');
        root.setProperty('--glow-strong', '0 0 20px #38bdf8');
      } else if (themeName === 'sunset') {
        root.setProperty('--bg-body', '#2a0a0a');
        root.setProperty('--bg-sidebar', '#3f1010');
        root.setProperty('--accent', '#f97316');
        root.setProperty('--glow-text', '0 0 10px #f97316');
        root.setProperty('--glow-strong', '0 0 20px #f97316');
      } else if (themeName === 'amoled') {
        root.setProperty('--bg-body', '#000000');
        root.setProperty('--bg-sidebar', '#000000');
        root.setProperty('--accent', '#ffffff');
        root.setProperty('--card-bg', '#050505');
      } else {
        // Midnight
        root.setProperty('--bg-body', '#202020');
        root.setProperty('--bg-sidebar', '#2b2b2b');
        root.setProperty('--accent', '#ffffff');
        root.setProperty('--card-bg', '#333333');
        root.setProperty('--glow-text', '0 0 10px rgba(255, 255, 255, 0.2)');
        root.setProperty('--glow-strong', '0 0 20px rgba(255, 255, 255, 0.5)');
      }
    }

    function updateTab() {
      userSettings.title = document.getElementById('input-title').value;
      userSettings.icon = document.getElementById('input-icon').value;
      document.title = userSettings.title;
      document.getElementById('dynamic-favicon').href = userSettings.icon;
    }

    function changeTheme(val) {
      userSettings.theme = val;
      updateTheme(val);
    }

    function updateParticlesRealtime(val) {
      document.getElementById('particle-val').innerText = val;
      userSettings.particles = parseInt(val);
      initParticles();
    }

    function saveSettings() {
      try {
        localStorage.setItem('el_settings', JSON.stringify(userSettings));
        closeSettings();
      } catch (e) {
        alert("Settings could not be saved (Storage Full). Your background image might be too large.");
      }
    }

    function openSettings() {
      document.getElementById('settings-modal').classList.add('active');
    }

    function closeSettings() {
      document.getElementById('settings-modal').classList.remove('active');
    }

    // --- 5. NAVIGATION, CLOCK & QUOTES ---

    function updateClock() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      document.getElementById('clock-time').innerText = `${hours}:${minutes}:${seconds} ${ampm}`;
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('clock-date').innerText = now.toLocaleDateString('en-US', options);
    }
    setInterval(updateClock, 1000);
    updateClock();

    function displayRandomQuote() {
        const quotes = [
            "coded by the skids, for the skids",
            "teachers hate ts",
            "unblocked and unlocked",
            "running on pure caffeine",
            "if you're reading this, do your homework",
            "no admins allowed",
            "security through obscurity",
            "ctrl + w to win instantly",
            "made with <3 and spaghetti code",
            "Set this up in alt tab to quickly escape",
            "L AH",
            "decode this: aHR0cHM6Ly9hbmRyZXdodWlzLmdheQ==",
            "last updated: feb 2, 2026",
            "need more blahaj",
            "typing this while going to class lol"
        ];
        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
        document.getElementById('random-quote').innerText = '"' + randomQuote + '"';
    }
    displayRandomQuote();

    function openAboutBlank() {
      let win = window.open();
      win.document.body.style.margin = '0';
      win.document.body.style.height = '100vh';
      let iframe = win.document.createElement('iframe');
      iframe.style.border = 'none';
      iframe.style.width = '100%';
      iframe.style.height = '100%';
      iframe.style.margin = '0';
      iframe.src = window.location.href;
      win.document.body.appendChild(iframe);
    }

    function switchPage(pageId, navElement) {
      document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
      const page = document.getElementById(pageId);
      if(page) page.classList.add('active');

      if (navElement) {
        document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
        navElement.classList.add('active');
      }

      if (pageId === 'home') displayRandomQuote();
      if (pageId === 'info-page') {
          const infoFrame = document.getElementById('info-frame');
          if (!infoFrame.getAttribute('src')) {
              infoFrame.src = atob('Li9pbmZvLmh0bWw=');
          }
      }
    }

    function startBrowsing() {
      switchPage('games-page');
      document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-link')[1].classList.add('active');
    }

    // --- GAME TIMER ---
    let startTime = Date.now();
    function updateGameTimer() {
        let diff = Math.floor((Date.now() - startTime) / 1000);
        let h = Math.floor(diff / 3600);
        let m = Math.floor((diff % 3600) / 60);
        let s = diff % 60;
        let formatted = (h > 0 ? h + ':' : '') + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;
        document.getElementById('game-timer').innerText = formatted;
        document.getElementById('session-display').innerText = formatted;
    }
    setInterval(updateGameTimer, 1000);

    // --- BATTERY ---
    function updateBatteryUI(battery) {
        const level = Math.round(battery.level * 100);
        const charging = battery.charging;
        const icon = document.getElementById('bat-icon');
        const text = document.getElementById('battery-level');
        text.innerText = level + '%';
        icon.className = "fa-solid";
        icon.classList.remove('bat-high', 'bat-med', 'bat-low', 'bat-charge');
        
        if (charging) {
            icon.classList.add('fa-bolt', 'bat-charge');
        } else {
            if(level > 75) icon.classList.add('fa-battery-full');
            else if(level > 50) icon.classList.add('fa-battery-three-quarters');
            else if(level > 25) icon.classList.add('fa-battery-half');
            else if(level > 10) icon.classList.add('fa-battery-quarter');
            else icon.classList.add('fa-battery-empty');
            
            if (level > 50) icon.classList.add('bat-high');
            else if (level > 20) icon.classList.add('bat-med');
            else icon.classList.add('bat-low');
        }
    }
    if (navigator.getBattery) {
        navigator.getBattery().then(function(battery) {
            updateBatteryUI(battery);
            battery.addEventListener('levelchange', function() { updateBatteryUI(battery); });
            battery.addEventListener('chargingchange', function() { updateBatteryUI(battery); });
        });
    } else {
        document.getElementById('battery-level').innerText = "N/A";
    }

    // --- INIT ---
    applySettings();

    // --- ONLINE USERS ---
    const onlineId = crypto.randomUUID();
    async function updateOnline() {
      try {
        const r = await fetch(`/api/online?id=${onlineId}`, { cache: "no-store" });
        if (!r.ok) return;
        document.getElementById("online-count").textContent = await r.text();
      } catch { }
    }
    updateOnline();
    setInterval(updateOnline, 15000);
				</script>
</body>

</html>